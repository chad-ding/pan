# HTTP修改器模块使用说明

## 功能概述

HTTP修改器是一个强大的浏览器扩展模块，允许你动态修改HTTP请求和响应，支持以下功能：

- **请求头修改**: 添加、修改或删除HTTP请求头
- **响应头修改**: 添加、修改或删除HTTP响应头  
- **请求地址重定向**: 将请求重定向到不同的URL
- **规则管理**: 支持规则的添加、编辑、删除、启用/禁用
- **批量操作**: 支持批量启用/禁用规则
- **导入导出**: 支持规则的导入和导出

## 主要特性

### 1. 多种修改类型
- **请求头修改**: 修改发送给服务器的HTTP头
- **响应头修改**: 修改服务器返回的HTTP头
- **请求地址重定向**: 将请求重定向到不同的URL

### 2. 灵活的操作类型
- **设置**: 添加或修改HTTP头/URL
- **删除**: 移除指定的HTTP头
- **重定向**: 将请求重定向到新地址（仅适用于请求地址）

### 3. 强大的URL匹配
- 支持通配符模式匹配
- 支持协议、域名、路径的精确匹配
- 支持正则表达式风格的匹配

### 4. 优先级管理
- 每个规则都有优先级设置
- 数字越大优先级越高
- 高优先级规则优先执行

## 使用方法

### 1. 访问模块

1. 打开浏览器扩展
2. 点击"HTTP修改器"标签页
3. 你将看到HTTP修改规则列表

### 2. 添加新规则

1. 点击"新增规则"按钮
2. 填写规则信息：
   - **规则名称**: 为规则起一个描述性的名称
   - **URL匹配模式**: 指定规则适用的URL模式
   - **修改类型**: 选择请求头、响应头或请求地址
   - **操作类型**: 选择设置、删除或重定向
   - **目标**: 指定要修改的目标（HTTP头名称或重定向URL）
   - **值**: 指定新的值（删除操作时留空）
   - **优先级**: 设置规则优先级（1-100）
3. 点击"保存"按钮

### 3. URL匹配模式示例

#### 基本模式
- `*://*.example.com/*` - 匹配example.com及其子域名
- `https://api.github.com/*` - 匹配GitHub API
- `*://*.google.com/search*` - 匹配Google搜索页面
- `*://*/*` - 匹配所有网站（谨慎使用）

#### 具体示例
- `http://localhost:3000/*` - 本地开发服务器
- `https://api.example.com/v1/*` - API v1版本
- `*://*.cdn.com/*.js` - CDN上的JavaScript文件
- `https://example.com/api/*` - 特定域名的API

### 4. 常见使用场景

#### 请求头修改示例

**修改User-Agent**
```
规则名称: 自定义User-Agent
URL匹配: *://httpbin.org/*
修改类型: 请求头
操作类型: 设置
目标: User-Agent
值: Custom-Browser/1.0
优先级: 10
```

**添加认证头**
```
规则名称: API认证
URL匹配: https://api.example.com/*
修改类型: 请求头
操作类型: 设置
目标: Authorization
值: Bearer your-token-here
优先级: 20
```

#### 响应头修改示例

**添加CORS支持**
```
规则名称: 本地开发CORS
URL匹配: http://localhost:3000/*
修改类型: 响应头
操作类型: 设置
目标: Access-Control-Allow-Origin
值: *
优先级: 10
```

**添加安全头**
```
规则名称: 安全头设置
URL匹配: https://mywebsite.com/*
修改类型: 响应头
操作类型: 设置
目标: X-Frame-Options
值: DENY
优先级: 15
```

#### 请求地址重定向示例

**API版本升级**
```
规则名称: API v1到v2重定向
URL匹配: https://api.example.com/v1/*
修改类型: 请求地址
操作类型: 重定向
目标: (留空)
值: https://api.example.com/v2/*
优先级: 10
```

**域名重定向**
```
规则名称: 旧域名重定向
URL匹配: https://old.example.com/*
修改类型: 请求地址
操作类型: 重定向
目标: (留空)
值: https://new.example.com/*
优先级: 20
```

### 5. 管理规则

#### 基本操作
- **编辑**: 点击规则行的"编辑"按钮修改规则
- **启用/禁用**: 点击"生效"/"失效"按钮切换规则状态
- **删除**: 点击"删除"按钮移除规则

#### 批量操作
- **全部生效**: 启用所有规则
- **全部失效**: 禁用所有规则

#### 导入导出
- **导出规则**: 将所有规则导出为JSON文件
- **导入规则**: 从JSON文件导入规则配置

## 高级功能

### 1. 规则优先级

规则按优先级执行，优先级数字越大越先执行。建议：

- **高优先级(80-100)**: 安全相关规则
- **中优先级(40-79)**: 功能相关规则  
- **低优先级(1-39)**: 调试和测试规则

### 2. 规则冲突处理

当多个规则匹配同一个请求时：

1. 按优先级排序执行
2. 相同优先级的规则按添加顺序执行
3. 后面的规则可能覆盖前面的规则

### 3. 性能优化

- 使用具体的URL模式而不是通配符
- 合理设置规则优先级
- 定期清理不需要的规则
- 避免过多的规则影响性能

## 测试和验证

### 1. 使用测试页面

1. 打开`test-http-modifier.html`文件
2. 添加相应的修改规则
3. 点击测试按钮验证效果

### 2. 使用浏览器开发者工具

1. 打开开发者工具（F12）
2. 切换到Network标签
3. 刷新页面或发起请求
4. 查看请求和响应头是否被修改

### 3. 使用在线工具

- 访问 https://httpbin.org/headers 查看请求头
- 使用 https://httpbin.org/user-agent 测试User-Agent
- 使用 https://httpbin.org/redirect/1 测试重定向

## 技术实现

### 权限要求

扩展需要以下权限：
- `declarativeNetRequest` - 修改网络请求
- `declarativeNetRequestWithHostAccess` - 访问主机权限
- `declarativeNetRequestFeedback` - 获取规则反馈
- `storage` - 存储规则配置

### 工作原理

1. **规则存储**: 规则存储在扩展的本地存储中
2. **规则转换**: 将用户规则转换为Chrome扩展API格式
3. **网络拦截**: 使用`chrome.declarativeNetRequest`API拦截和修改网络请求
4. **实时更新**: 规则修改后立即生效

### 规则ID分配

- HTTP修改规则使用ID范围：1000-1999
- 每个规则有唯一ID，避免冲突
- 规则按添加顺序分配ID

## 最佳实践

### 1. 规则命名
- 使用描述性的名称
- 包含环境信息（开发、测试、生产）
- 包含功能描述和版本信息

### 2. URL匹配
- 尽量使用具体的URL模式
- 避免过度使用通配符
- 考虑安全性影响

### 3. 优先级设置
- 安全规则设置高优先级
- 功能规则设置中等优先级
- 调试规则设置低优先级

### 4. 测试验证
- 在测试环境验证规则效果
- 使用开发者工具检查修改结果
- 测试不同浏览器兼容性

### 5. 规则管理
- 定期清理不需要的规则
- 备份重要的规则配置
- 记录规则的作用和影响

## 故障排除

### 常见问题

#### 规则不生效
1. 检查规则是否已启用
2. 验证URL匹配模式是否正确
3. 确认扩展权限是否足够
4. 查看浏览器控制台是否有错误

#### 规则冲突
1. 检查是否有重复的规则
2. 确认规则优先级设置
3. 验证URL模式是否重叠

#### 性能问题
1. 减少规则数量
2. 优化URL匹配模式
3. 合理设置优先级

### 调试技巧

1. **使用开发者工具**: 查看Network标签中的请求详情
2. **检查控制台**: 查看扩展的错误信息
3. **测试单个规则**: 逐个测试规则效果
4. **使用测试页面**: 利用提供的测试页面验证功能

## 更新日志

### v1.0.0
- 初始版本发布
- 支持请求头、响应头、请求地址修改
- 提供规则管理界面
- 支持导入导出功能
- 支持优先级设置

## 贡献

欢迎提交问题报告和功能建议！

## 许可证

本项目采用MIT许可证。 
